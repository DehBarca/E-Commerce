<!doctype html>
<html lang="en">
    <head>
        <title> Chayos Market</title>
        <!-- Required meta tags -->
        <meta charset="utf-8" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1, shrink-to-fit=no"
        />

        <!-- Bootstrap CSS v5.2.1 -->
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
            rel="stylesheet"
            integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
            crossorigin="anonymous"
        />
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.1/css/all.css" integrity="sha384-O8whS3fhG2OnA5Kas0Y9l3cfpmYjapjI0E4theH4iuMD+pLhbf6JI0jIMfYcK3yZ" crossorigin="anonymous">
        <style>
            .cart-badge {
                position: relative;
                top: -10px;
                left: -5px;
                font-size: 0.7em;
            }
        </style>
        <script src="../cart.js" defer></script>
    </head>

    <body>
        <header>
            <!-- place navbar here -->
             <nav
                class="navbar navbar-expand-sm navbar-light bg-primary data-bs-theme=" data-bs-theme="dark"
             >
                <div class="container">
                    <a class="navbar-brand" href="index.html"> Chayos Market漏</a>
                    <button
                        class="navbar-toggler d-lg-none"
                        type="button"
                        data-bs-toggle="collapse"
                        data-bs-target="#collapsibleNavId"
                        aria-controls="collapsibleNavId"
                        aria-expanded="false"
                        aria-label="Toggle navigation"
                    >
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <div class="collapse navbar-collapse" id="collapsibleNavId">
                        <ul class="navbar-nav me-auto mt-2 mt-lg-0">
                            <li class="nav-item">
                                <a class="nav-link active" href="index.html" aria-current="page"
                                    >Home
                                    <span class="visually-hidden">(current)</span></a
                                >
                            </li>
                            <li class="nav-item dropdown">
                                <a
                                    class="nav-link dropdown-toggle"
                                    href="#"
                                    id="dropdownId"
                                    data-bs-toggle="dropdown"
                                    aria-haspopup="true"
                                    aria-expanded="false"
                                    >Categor铆as</a
                                >
                                <div
                                    class="dropdown-menu"
                                    aria-labelledby="dropdownId"
                                >
                                    <a class="dropdown-item" href="#"
                                        >Frutas</a
                                    >
                                    <a class="dropdown-item" href="#"
                                        >Verduras</a
                                    >
                                    <a class="dropdown-item" href="#"
                                        >Electr贸nicos</a
                                    >
                                </div>
                            </li>
                        </ul>
                        <form class="d-flex my-2 my-lg-0">
                            <input
                                class="form-control me-sm-2"
                                type="text"
                                placeholder="Buscar producto..."
                            />
                            <button
                                class="btn btn-primary my-2 my-sm-0"
                                type="submit"
                            >
                                Search
                            </button>

                            <button 
                            class= "btn btn-primary my-2 my-sm-0"
                            type="button"
                            data-bs-toggle="modal" data-bs-target="#login">
                             <i class="fa fa-user" aria-hidden="true">  Login</i> 
                            </button> 
                            <a href="shopping_cart.html" class="button-class btn btn-primary my-sm-0"><i class="fa fa-shopping-cart" aria-hidden="true"></i></a>
                            
                        </form>
                    </div>
                </div>
             </nav>

             <!-- Login Modal -->
             <div class="modal fade" id="login" tabindex="-1" data-bs-backdrop="static" aria-labelledby="loginModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title fs-5" id="loginModalLabel">Iniciar Sesi贸n</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body justify-content-between align-items-center">
                            <form>
                                <div class="form-group">
                                    <label for="email">Correo electr贸nico</label>
                                    <input type="email" class="form-control" id="email" placeholder="abc@gmail.com" required> 
                                </div>
                                <div class="form-group">
                                    <label for="password">Contrase帽a</label>
                                    <input type="password" class="form-control" id="password" placeholder="Contrase帽a123" required><br>
                                </div>
                                <div class="d-flex justify-content-between align-items-center modal-footer">
                                    <button type="submit" class="btn btn-success">Log In</button>
                                    <button class="btn btn-primary" data-bs-target="#register" data-bs-toggle="modal">Register</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Register Modal -->
            <div class="modal fade" id="register" aria-hidden="true" aria-labelledby="register" tabindex="-1">
                <div class="modal-dialog modal-dialog-centered">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h1 class="modal-title fs-5" id="exampleModalToggleLabel2">Register</h1>
                      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body justify-content-between align-items-center">
                      <form>
                        <div class="mb-3">
                            <label for="" class="form-label">Name</label>
                            <input
                                type="text"
                                class="form-control"
                                name=""
                                id=""
                                aria-describedby="helpId"
                                placeholder="Pedro S谩nchez" required
                            />
                        </div>
                        
                        <div class="mb-3">
                            <label for="" class="form-label">Email</label>
                            <input
                                type="email"
                                class="form-control"
                                name=""
                                id=""
                                aria-describedby="emailHelpId"
                                placeholder="abc@mail.com" required
                            />
                        </div>
                        <div class="mb-3">
                            <label for="" class="form-label">Password</label>
                            <input
                                type="password"
                                class="form-control"
                                name=""
                                id=""
                                placeholder="papitasricas" required
                            />
                        </div>
                        
                        
                     
                    </div>
                    <div class="d-flex justify-content-between align-items-center modal-footer">
                      <button type="submit" class="btn btn-success">Register</button>
                      <button class="btn btn-primary" data-bs-target="#login" data-bs-toggle="modal">Log In</button>
                    </div> </form>
                  </div>
                </div>
              </div>
              
             
        </header>
        <main>

            <!-- Carrusel -->
            <div class="container-fluid m-3">
                <div class="container-fluid p-3">
                    <div id="carouselId" class="carousel slide" data-bs-ride="carousel">
                        <div class="carousel-indicators">
                            <button type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
                            <button type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide-to="1" aria-label="Slide 2"></button>
                            <button type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide-to="2" aria-label="Slide 3"></button>
                          </div>
                        
                        <div class="carousel-inner" role="listbox">
                            <div class="carousel-item active">
                                <img
                                    src="https://alternacalidad.com/wp-content/uploads/2021/10/productos-electricos-electronicos.jpeg"
                                    class="w-100 d-block"
                                    alt="First slide"
                                    height="250px"
                                    style="object-fit: cover;"
                                />
                            </div>
                            <div class="carousel-item">
                                <img
                                    src="https://static-resources.mirai.com/wp-content/uploads/sites/1738/20241217100716/1.-Frutas-tropicales-Caribe.jpg"
                                    class="w-100 d-block"
                                    alt="Second slide"
                                    height="250px"
                                    style="object-fit: cover;"
                                />
                            </div>
                            <div class="carousel-item">
                                <img
                                    src="https://cookio.es/wp-content/uploads/2023/05/verduras-1024x683.jpg"
                                    class="w-100 d-block"
                                    alt="Third slide"
                                    height="250px"
                                    style="object-fit: cover;"
                                />
                            </div>
                        </div>
                        <button
                            class="carousel-control-prev"
                            type="button"
                            data-bs-target="#carouselId"
                            data-bs-slide="prev"
                        >
                            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                            <span class="visually-hidden">Previous</span>
                        </button>
                        <button
                            class="carousel-control-next"
                            type="button"
                            data-bs-target="#carouselId"
                            data-bs-slide="next"
                        >
                            <span class="carousel-control-next-icon" aria-hidden="true"></span>
                            <span class="visually-hidden">Next</span>
                        </button>
                    </div>
                    
                    <img src="" class="img-fluid" alt="">
                </div>
            </div>

            <!-- Cards -->
            <div class="container">
                <div class="row">
                </div>
            </div> <br>
            
            
            <!-- Paginaci贸n -->
            <nav aria-label="Page navigation">
                <ul
                    class="pagination justify-content-center   "
                >
                    <li class="page-item disabled">
                        <a class="page-link" href="#" aria-label="Previous">
                            <span aria-hidden="true">&laquo;</span>
                        </a>
                    </li>
                    <li class="page-item active" aria-current="page">
                        <a class="page-link" href="#">1</a>
                    </li>
                    <li class="page-item"><a class="page-link" href="#">2</a></li>
                    <li class="page-item">
                        <a class="page-link" href="#">3</a>
                    </li>
                    <li class="page-item">
                        <a class="page-link" href="#" aria-label="Next">
                            <span aria-hidden="true">&raquo;</span>
                        </a>
                    </li>
                </ul>
            </nav>
            
        </main>
        <footer>
            <!-- place footer here -->
        </footer>
        <!-- Bootstrap JavaScript Libraries -->
        <script
            src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
            integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
            crossorigin="anonymous"
        ></script>

        <script
            src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"
            integrity="sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+"
            crossorigin="anonymous"
        ></script>

        <script>
          let currentPage = 1;
          let productsPerPage = 4;
          let allProducts = [];

          // Funci贸n para obtener los productos desde el servidor
          async function fetchProducts() {
            try {
              const response = await fetch('http://localhost:3100/products');
              allProducts = await response.json();
              displayProducts(currentPage);
              setupPagination();
            } catch (error) {
              console.error('Error al obtener los productos:', error);
            }
          }

          // Funci贸n para mostrar los productos de la p谩gina actual
          function displayProducts(page) {
            const container = document.querySelector('.row');
            container.innerHTML = '';

            const start = (page - 1) * productsPerPage;
            const end = start + productsPerPage;
            const paginatedProducts = allProducts.slice(start, end);

            paginatedProducts.forEach(product => {
              const productCard = `
                <div class="col-6 col-md-4 col-lg-3">
                  <div class="card" style="width: 18rem;">
                    <img src="${product.imageUrl}" class="card-img-top" alt="${product.title}" style="object-fit: cover;" height="250px">
                    <div class="card-body">
                      <h5 class="card-title">${product.title}</h5>
                      <p class="card-text">${product.description}</p>
                      <p class="card-text">$${product.pricePerUnit} ${product.unit}</p>
                      <div class="text-end">
                        <button 
                          class="btn btn-primary"
                          onclick="showQuantityModal({
                            uuid: '${product.uuid}',
                            name: '${product.title}',
                            price: ${product.pricePerUnit},
                            unit: '${product.unit}',
                            image: '${product.imageUrl}',
                            description: '${product.description}'
                          })"
                        >
                          <i class="fa fa-shopping-cart"></i> Agregar al carrito
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              `;
              container.innerHTML += productCard;
            });
          }

          // Funci贸n para configurar la paginaci贸n
          function setupPagination() {
            const totalPages = Math.ceil(allProducts.length / productsPerPage);
            const paginationContainer = document.querySelector('.pagination');
            paginationContainer.innerHTML = '';

            // Bot贸n Previous
            paginationContainer.innerHTML += `
              <li class="page-item ${currentPage === 1 ? 'disabled' : ''}">
                <a class="page-link" href="#" aria-label="Previous" onclick="changePage(${currentPage - 1})">
                  <span aria-hidden="true">&laquo;</span>
                </a>
              </li>
            `;

            // N煤meros de p谩gina
            for (let i = 1; i <= totalPages; i++) {
              paginationContainer.innerHTML += `
                <li class="page-item ${currentPage === i ? 'active' : ''}" aria-current="page">
                  <a class="page-link" href="#" onclick="changePage(${i})">${i}</a>
                </li>
              `;
            }

            // Bot贸n Next
            paginationContainer.innerHTML += `
              <li class="page-item ${currentPage === totalPages ? 'disabled' : ''}">
                <a class="page-link" href="#" aria-label="Next" onclick="changePage(${currentPage + 1})">
                  <span aria-hidden="true">&raquo;</span>
                </a>
              </li>
            `;
          }

          // Funci贸n para cambiar de p谩gina
          function changePage(page) {
            if (page < 1 || page > Math.ceil(allProducts.length / productsPerPage)) return;
            currentPage = page;
            displayProducts(currentPage);
            setupPagination();
          }

          // Funci贸n para actualizar el 铆cono del carrito
          function updateCartIcon() {
            const cart = JSON.parse(sessionStorage.getItem('cart') || '[]');
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            
            // Update cart icon badge
            const cartIcon = document.querySelector('.fa-shopping-cart');
            const badge = document.querySelector('.cart-badge');
            
            if (totalItems > 0) {
                if (!badge) {
                    cartIcon.insertAdjacentHTML('afterend', 
                        `<span class="badge bg-danger cart-badge">${totalItems}</span>`);
                } else {
                    badge.textContent = totalItems;
                }
            } else if (badge) {
                badge.remove();
            }
          }

          // Cargar los productos al iniciar la p谩gina
          document.addEventListener('DOMContentLoaded', () => {
              fetchProducts();
              updateCartIcon();
          });

          let selectedProduct = null;

          function showQuantityModal(product) {
              selectedProduct = {
                  uuid: product.uuid,
                  title: product.name,
                  imageUrl: product.image,
                  description: product.description,
                  pricePerUnit: product.price,
                  unit: product.unit
              };
              
              document.getElementById('modalProductImage').src = product.image;
              document.getElementById('modalProductName').textContent = product.name;
              document.getElementById('modalProductPrice').textContent = `$${product.price} ${product.unit}`;
              document.getElementById('quantityInput').value = 1;
              
              const modal = new bootstrap.Modal(document.getElementById('quantityModal'));
              modal.show();
          }

          function updateModalQuantity(change) {
              const input = document.getElementById('quantityInput');
              const newValue = Math.max(1, parseInt(input.value) + change);
              input.value = newValue;
          }

          function confirmAddToCart() {
              const quantity = parseInt(document.getElementById('quantityInput').value);
              if (quantity < 1) return;
              
              cart.addToCart(selectedProduct, quantity);
              
              const modal = bootstrap.Modal.getInstance(document.getElementById('quantityModal'));
              modal.hide();
          }
        </script>

        <div class="modal fade" id="quantityModal" tabindex="-1" aria-labelledby="quantityModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="quantityModalLabel">Seleccionar Cantidad</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="text-center">
                            <img id="modalProductImage" src="" alt="" class="img-fluid mb-2" style="max-height: 150px; object-fit: contain;">
                            <h6 id="modalProductName"></h6>
                            <p id="modalProductPrice"></p>
                        </div>
                        <div class="input-group justify-content-center">
                            <button class="btn btn-outline-secondary" type="button" onclick="updateModalQuantity(-1)">-</button>
                            <input type="number" class="form-control text-center" id="quantityInput" value="1" min="1" style="max-width: 100px">
                            <button class="btn btn-outline-secondary" type="button" onclick="updateModalQuantity(1)">+</button>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                        <button type="button" class="btn btn-primary" onclick="confirmAddToCart()">Agregar al Carrito</button>
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>
``` 
